[Core Pricing]FCombination:markToMarketInstrumentPositionValues = shunt[priceSource, doSplitAll, valuesOnSpotOverride, positionTradeQuantities, useFallbackToTheoreticalValues, useBidAskValuation](useMarkToMarketPriceToday, 
  0->collapse(combinationMarkToMarketInstrumentPositionValues), 
  1->shunt[priceSource, doSplitAll, valuesOnSpotOverride, positionTradeQuantities, useFallbackToTheoreticalValues, useBidAskValuation](hasMarkToMarketPriceToday, 
    true->collapse(combinationMarkToMarketValuesToday), 
    false->collapse(combinationMarkToMarketInstrumentPositionValues)), 
  2->collapse(combinationMarkToMarketValuesToday));
[Core Pricing]FInstrument:markToMarketInstrumentPositionValues = select(mtmFromFeed, 
  true->select(useFallbackToTheoreticalValues, 
    true->select(isFinite(marketPrice), 
      true->collapse(marketInstrumentPositionValues), 
      false->collapse(theoreticalOrFixedInstrumentPositionValues)), 
    false->collapse(marketInstrumentPositionValues)), 
  false->collapse(theoreticalOrFixedInstrumentPositionValues));