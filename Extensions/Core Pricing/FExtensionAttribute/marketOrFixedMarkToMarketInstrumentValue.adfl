[Core Pricing]FCurrency:marketOrFixedMarkToMarketInstrumentValue = instrumentSpotZero;
[Core Pricing]FInstrument:marketOrFixedMarkToMarketInstrumentValue = switch(useMarketPrice, 
  true->shunt[priceSource, accountingParameters, isBook](useMarkToMarketPriceToday, 
    0->marketSpotValue, 
    1->shunt[priceSource, accountingParameters, isBook](hasMarkToMarketPriceToday, 
      true->collapse(markToMarketSpotValue), 
      false->marketSpotValue), 
    2->collapse(markToMarketSpotValue)), 
  default->instrumentSpotZero);