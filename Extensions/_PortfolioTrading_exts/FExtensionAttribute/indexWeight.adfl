[_PortfolioTrading_exts]FSingleInstrumentAndTrades:indexWeight = select(indexCombInstMap, 
  nil->0.0, 
  default->float(denominatedvalue(indexCombInstMap:theoreticalLegComponentValue [targetIndex:priceSource], targetIndex.Currency, , valuationDate) / denominatedvalue(targetIndex:theoreticalPrice [doSplitAll = true], targetIndex.Currency, , valuationDate)));