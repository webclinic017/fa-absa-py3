[Profit and Loss]FBuySellBack:marketInstrumentValuesOnAcquireDateForProfitAndLoss = underlying:marketInstrumentValuesOnAcquireDateForProfitAndLossToday [marketSpotValuesForProfitAndLoss, positionAdjustmentDates, moveCoupons = false, moveFixedAmounts = false, positionFlatAccruedAdjustment = false, valuationBaseDateTimeInput];
[Profit and Loss]FCashFlowInstrument:marketInstrumentValuesOnAcquireDateForProfitAndLoss = select(valuesOnSpot, 
  true->marketInstrumentValuesOnAcquireDateForProfitAndLossViaSpot, 
  false->select("Accounting Date" == instrumentReportDate, 
    true->marketInstrumentValuesOnAcquireDateForProfitAndLossViaAccountingDate, 
    false->marketInstrumentValuesOnAcquireDateForProfitAndLossToday));
[Profit and Loss]FCombination:marketInstrumentValuesOnAcquireDateForProfitAndLoss = select(valuesOnSpot, 
  true->collapse(marketInstrumentValuesOnAcquireDateForProfitAndLossViaSpot), 
  false->select(("Accounting Date" == instrumentReportDate) and needsLegInformation, 
    true->collapse(marketInstrumentValuesOnAcquireDateForProfitAndLossViaAccountingDate), 
    false->collapse(marketInstrumentValuesOnAcquireDateForProfitAndLossToday)));
[Profit and Loss]FFxRate:marketInstrumentValuesOnAcquireDateForProfitAndLoss = object:moveValueFlat [priceSource, valuationBaseDateTimeInput, moveStartValue = marketSpotValuesForProfitAndLoss, moveToDate = positionAdjustmentDates];
[Profit and Loss]FInstrument:marketInstrumentValuesOnAcquireDateForProfitAndLoss = moveValue(marketSpotValuesForProfitAndLoss, valuationOrSpotDate, instrumentSpotDate, positionAdjustmentDates, repoCurveForProfitAndLoss);