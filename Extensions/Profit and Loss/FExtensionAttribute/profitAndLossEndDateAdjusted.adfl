[Profit and Loss]FCombInstrMapAndTrades:profitAndLossEndDateAdjusted = instrument :* "profitAndLossEndDateAdjusted" [profitAndLossEndDate];
[Profit and Loss]FInstrument:profitAndLossEndDateAdjusted = select(valuesOnSpot, 
  true->object.SpotDate(profitAndLossEndDate), 
  false->profitAndLossEndDate);
[Profit and Loss]FLegAndTrades:profitAndLossEndDateAdjusted = instrument :* "profitAndLossEndDateAdjusted" [profitAndLossEndDate];
[Profit and Loss]FSingleInstrumentAndTrades:profitAndLossEndDateAdjusted = instrument :* "profitAndLossEndDateAdjusted" [profitAndLossEndDate];
[Profit and Loss]FTradeRow:profitAndLossEndDateAdjusted = instrument :* "profitAndLossEndDateAdjusted" [profitAndLossEndDate];