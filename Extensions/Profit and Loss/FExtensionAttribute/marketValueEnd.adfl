[Profit and Loss]FInstrumentAndTrades:marketValueEnd = select(needsValueAtCostAdjustment, 
  true->marketValueEndCalculation + valueAtCostMarketValueAdjustmentEnd, 
  false->collapse(marketValueEndCalculation));