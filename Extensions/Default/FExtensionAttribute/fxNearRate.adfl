[Default]FCurrency:fxNearRate = fxRateInstrument :* "fxNearRate" [fxForwardDate, fxPriceFindingPriceType, discountingType];
[Default]FFxRate:fxNearRate[fxForwardDate, fxPriceFindingPriceType, discountingType] = select(foreignEqualsDomestic, 
  true->1, 
  false->shunt[fxForwardDate, fxPriceFindingPriceType, discountingType]((instrumentSpotDate == fxForwardDate), 
    true->fxSpotRate, 
    false->(domesticCurrency:fxDiscountCurve [discountingType]).DiscountValue(fxSpotRate, fxForwardDate) * (foreignCurrency:fxDiscountCurve [discountingType]).Discount(instrumentSpotDate, fxForwardDate)));
[Default]FFxSwap:fxNearRate = currency1 :* "fxNearRate" [fxToCurrency := currency2, fxForwardDate = nearDate, discountingType];