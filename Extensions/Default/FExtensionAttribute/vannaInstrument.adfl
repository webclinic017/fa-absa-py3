[Default]FCombInstrMapAndTrades:vannaInstrument = combinationInstrumentMapFactor * instrument :* "vannaInstrument" [isSplitAllGrouped, priceSource, priceGreekIncludeVolatilityMovement];
[Default]FInstrument:vannaInstrument = select(isSettled, 
  true->denominatedValueZero, 
  false->select((priceGreekRiskFactorNodeCount == 1) and (volatilityGreekRiskFactorCount > 0), 
    true->stripDateTimePart(vannaPercentValuesInstrument) / (singlePriceGreekRiskFactorValueInInstrumentCurrency * percentAdjustmentFactor), 
    false->denominatedValueZero));
[Default]FInstrumentAndTrades:vannaInstrument = openInstrumentOrInstrument :* "collapse(vannaInstrument)" [isSplitAllGrouped, priceSource, normalizeFxRisk, priceGreekIncludeVolatilityMovement];
[Default]FMultiInstrumentAndTrades:vannaInstrument = nil;
[Default]FPriceAggregate:vannaInstrument = instrument :* "vannaInstrument" [priceSource];
[Default]FTradeRow:vannaInstrument = instrument:vannaInstrument [isSplitAllGrouped, priceSource, normalizeFxRisk, priceGreekIncludeVolatilityMovement, currency = tradeRowCurrency];