[Default]FCombInstrMapAndTrades:priceGammaProviderValues = shunt(isOpenPosition, 
  true->riskPosition * adjustForSpotHandling(instrument :* "priceGammaProviderValuesInstrument" [isSplitAllGrouped, priceSource, priceGreekIncludeVolatilityMovement, priceGreekProviderShiftSize, priceGreekProviderUseRelativeShift, priceGreekShiftFilter, useCommodityRiskFactors], valuesOnSpot), 
  false->spotHandlingZero);
[Default]FInstrument:priceGammaProviderValues = adjustForSpotHandling(denominatedValueOrBasket(priceGammaProviderValuesInstrument * riskPosition), valuesOnSpot);
[Default]FInstrumentAndTrades:priceGammaProviderValues = openInstrument :* "collapse(priceGammaProviderValues)" [isSplitAllGrouped, priceSource, positionObject, priceGreekIncludeVolatilityMovement, priceGreekProviderShiftSize, priceGreekProviderUseRelativeShift, priceGreekShiftFilter, useCommodityRiskFactors];
[Default]FMultiInstrumentAndTrades:priceGammaProviderValues = sumOf(openInstruments :* "collapse(priceGammaProviderValues)" [isSplitAllGrouped, priceSource, positionObject, priceGreekIncludeVolatilityMovement, priceGreekProviderShiftSize, priceGreekProviderUseRelativeShift, priceGreekShiftFilter, useCommodityRiskFactors]);