[Core Cash Flow Pricing]FInstrumentAndTrades:projectedFactor = select(instrument:isRepoInstrument and instrument:isSingleLegInstrument, 
  true->instrument:projectedFactor [projectedRightDate = trade.ValueDay, factorFilter] * trade.Quantity, 
  false->nil);
[Core Cash Flow Pricing]FLeg:projectedFactor = sumOf(double(staticLegInformation.ProjectedCashFlow(valuationDate, projectedRightDate, legInformation, roundingInformation, factorFilter)));
[Core Cash Flow Pricing]FRepoInstrument:projectedFactor = firstLeg:projectedFactor [projectedRightDate, factorFilter] * contractSize;