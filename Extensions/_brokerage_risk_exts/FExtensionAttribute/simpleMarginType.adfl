[_brokerage_risk_exts]FCurrency:simpleMarginType = nil;
[_brokerage_risk_exts]FInstrument:simpleMarginType = shunt((collateralPosition == 0) and (portfolio:portfolioType <> "Cash Account"), 
  true->switch(spanInstruments.HasKey(object.Oid), 
    true->"SPAN", 
    default->switch(initialMarginCondition <> nil, 
      true->initialMarginCurve.CurveType, 
      default->"Default")), 
  default->nil);
[_brokerage_risk_exts]FSingleInstrumentAndTrades:simpleMarginType = instrument:simpleMarginType [portfolio, positionObject];