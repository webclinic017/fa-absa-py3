[_brokerage_risk_exts]FCurrency:quantityCap = 0.0;
[_brokerage_risk_exts]FInstrument:quantityCap = shunt((collateralPosition > 0) and (quantityCapCondition <> nil), 
  true->quantityCapCurve.MinValue, 
  false->0.0);
[_brokerage_risk_exts]FSingleInstrumentAndTrades:quantityCap = instrument:quantityCap [portfolio, positionObject];