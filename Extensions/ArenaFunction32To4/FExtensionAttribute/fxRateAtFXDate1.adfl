[ArenaFunction32To4]FCurrency:fxRateAtFXDate1 = shunt[fxToCurrency](fxDate1 == fxDate2, 
  true->fxMatrixValue * fxZeroRateCurve.Discount(fxDate1, fxBaseDate), 
  false->fxMatrix.GetCell(fxBaseCurrency, fxToCurrency).CellValue(valuationDate) * fxZeroRateCurve.DiscountValues(fxRateAtFXDate2, fxDate1));