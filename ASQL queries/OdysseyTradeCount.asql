select
p.prfid,
i.insid,
cp.ptyid,
count(t.trdnbr)
from
trade t,
instrument i,
portfolio p,
party cp
where
t.insaddr = i.insaddr
and t.counterparty_ptynbr = cp.ptynbr
and p.prfnbr = t.prfnbr
and match_filter(t,@1_Filter{OdysseyTradeCount;tradefilter.fltid*})

group by 1,3,2