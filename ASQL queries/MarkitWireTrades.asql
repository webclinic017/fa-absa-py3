/*
**************Developments******************

Purpose               : Ops/PCG require a report that gives them a view to all trades booked via markitwire
Department and Desk   : OPS/PCG
Requester             : Miguel da Silva
Developer             : Anwar Banoo
CR Number             : 362423

********************************************
*/

/* Usage code for this ASQL */
select
ael_i(p,'ASQL_log','MarkitWire_Trades') 'Name'
into  ASQL_LOG_TEMP
from TextObject p where 
p.name = 'MarkitWire_Trades' and p.type = 'SQL Query' 

select
    t.trdnbr 'Trade Nbr', 
    add_info(t, 'MarkitWire') 'MW Key',
    add_info(t, 'CCPmiddleware_id') 'CCP Key',
    add_info(t, 'CCPclearing_process') 'StateChart',
    add_info(t, 'CCPclearing_status') 'Status',
    add_info(t, 'CCPmiddleware_ptynb') 'Party',
    add_info(t, 'CCPmiddleware_versi') 'Version',
    add_info(t, 'CCPmwire_booking_st') 'BookingState',
    add_info(t, 'CCPmwire_contract_s') 'ContractState',
    add_info(t, 'CCPmwire_message_st') 'MessageStatus',
    add_info(t, 'CCPmwire_new_status') 'NewStatus',
    add_info(t, 'CCPmwire_process_st') 'ProcessStatus',
    add_info(t, 'CCPmwire_user_msg') 'UserMessage',
    i.exp_Day 'Expiry',
    i.insid 'Ins ID',
    i.instype 'Type',
    t.status 'Status',
    t.value_day 'Effective',
    display_id(i, 'curr')    'Currency',
    nominal_amount(t) 'Nominal',
    display_id(t, 'acquirer_ptynbr') 'Acquirer',
    display_id(t, 'counterparty_ptynbr')    'Counterparty',
    u.userid 'Trader',
    t.time  'Trade Date',
    t.acquire_day   'Acquire Date',
    t.value_day 'Value Date'
from
    trade t, 
    instrument i, 
    user u,
    AdditionalInfo ai,
    AdditionalInfoSpec ais
where 
    i.insaddr = t.insaddr
and ai.recaddr = t.trdnbr
and ai.addinf_specnbr = ais.specnbr
and t.optional_key LIKE 'MW%'
and t.trader_usrnbr = u.usrnbr
and ((@4_Trader{All;user.userid} = 'All') or 
    (u.userid in (@4_Trader{All;user.userid})))
and (i.instype in (@3_Instype{Swap;'Swap','FRA', 'CurrSwap'*}))
and t.time >= @1_StartDay{Yesterday;}
and t.time <= @2_EndDay{Today;}

order by 
    t.trdnbr