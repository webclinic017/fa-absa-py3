import ael, acm

instruments = [
57485,
155896,
297504,
300240,
432091,
437800,
445052,
449804,
453226,
455678,
460653,
460667,
460671,
460677,
460699,
461049,
461055,
461057,
461060,
461106,
461110,
461112,
461535,
462260,
462682,
462711,
464369,
464393,
464464,
480130,
484082,
484083,
484084,
487532,
487558,
487559,
487623,
487627,
488023,
488028,
490416,
490425,
490549,
490579,
490590,
490593,
490599,
490603,
490622,
490652,
490667,
490669,
490975,
493509,
533638,
534568,
534569,
534571,
538017,
538290,
538906,
550454,
553224,
556813,
558094,
558598,
561925,
561963,
561998,
563238,
565086,
565090,
565206,
568744,
568980,
568984,
569453,
569455,
569902,
569912,
571315,
571318,
571420,
571435,
571439,
571440,
571441,
585348,
589845,
589847,
592349,
592795,
594432,
594603,
595275,
595285,
595819,
596525,
596533,
596577,
596661,
596923,
597454,
597459,
597486,
597532,
597535,
597542,
597544,
597546,
597838,
597839,
597984,
597986,
598104,
598105,
598106,
598107,
601304,
601305,
602335,
602336,
606916,
606921,
606924,
609877,
609963,
609968,
610363,
610406,
610737,
610739,
610741,
610837,
610868,
611440,
612506,
612675,
612983,
613190,
613707,
613711,
614210,
614766,
615170,
615265,
615267,
615464,
615482,
615683,
616245,
616248,
617155,
617261,
618205,
618309,
618310,
618311,
618312,
619649,
629416,
631146,
631147,
631148,
638768,
639319,
640805,
641665,
641666,
642090,
642441,
643333,
644515,
644516,
644841,
644843,
644967,
648863,
648866,
651914,
656408,
657277,
657280,
657281,
657282,
657289,
657302,
657312,
660789,
660796,
667381,
667397,
668083,
668088,
668090,
673481,
673759,
677212,
677735,
680737,
682476,
682973,
682974,
682978,
683224,
683482,
683490,
683491,
683952,
684036,
684764,
684767,
684774,
685015,
685019,
685021,
685022,
685204,
686377,
686962,
701182,
701188,
703430,
712628,
713696,
713697,
713700,
713701,
713916,
713922,
716756,
716757,
722707,
723546,
725033,
725637,
725638,
725650,
725653,
725774,
726512,
726514,
733943,
735621,
738881,
753457,
756858,
760054,
760120,
763214,
763750,
763919,
767507,
767509,
767982,
768427,
773067,
781063,
789313,
798702,
806751,
806758,
807468,
808565,
815152,
820543,
828560,
829279,
829280,
829286,
829532,
829533,
829567,
829568,
836152,
839742,
839744,
839745,
849067,
849069,
850613,
850614,
851628,
851633,
853619,
855263,
855807,
858476,
858477,
871070,
871071,
871743,
871744,
871908,
871915,
876189,
876190,
876191,
876192,
876193,
876195,
876199,
876203,
876204,
876205,
876206,
876918,
876919,
880320,
880645,
881265,
882454,
882458,
883578,
883581,
883597,
883598,
886007,
886008,
886010,
886026,
903780,
904060,
904061,
911565,
912335,
914381,
914711,
917928,
917930,
918058,
921071,
931167,
940348,
970617,
970618,
971000,
974388,
974394,
974395,
982967,
983882,
984383,
984387,
985025,
985026,
988096,
991424,
1029715,
1035083,
1041402,
1042035,
1044591,
1045647,
1045648,
1049514,
1056349,
1101787,
1101804,
1101805,
1105095,
1105178,
1124971,
1156670,
1156674,
1182886,
1182888,
1201890,
1226796,
1226797,
1226799,
1226800,
1244288,
1244289,
1245088,
1245090,
1265564,
1267098,
1267100,
1267103,
1267991,
1267993,
1271063,
1271077,
1271432,
1271436,
1287224,
1287234,
1310501,
1311234,
1311357,
1313065,
1337754,
1546041,
1546043,
1573421,
1573453,
1658144,
1658145,
1676593,
1683812,
1684881,
1692824,
1692825,
1739357,
1739359,
1749681,
1749688,
1749737,
1753666,
1756005,
1756115,
1796851,
1796852,
1798929,
1928848,
1935273,
1938507,
1952519,
1952520,
1952521,
1952523,
1969011,
1969019,
1977403,
2102895,
2136721,
2136723,
2136727,
2136742,
2136768,
2154184,
2154185,
2154186,
2154189,
2159334,
2162391,
2162392,
2162393,
2162394,
2162395,
2162396,
2162397,
2162398,
2162399,
2162401,
2162402,
2162403,
2162404,
2162406,
2162408,
2167285,
2167286,
2167287,
2167302,
2204179,
2204181,
2204192,
2204193,
2204194,
2243232,
2245053,
2245071,
2245302,
2245388,
2275350,
2275508,
2372645,
2378008,
2378009,
2388644,
2388646,
2388667,
2393276,
2393281,
2394264,
2394265,
2394266,
2394267,
2394291,
2394801,
2394805,
2394840,
2395235,
2396694,
2398619,
2400274,
2408923,
2410169,
2410313,
2427583,
2438429,
2438433,
2450558,
2490041,
2490042,
2490043,
2490204,
2490205,
2490206,
2490207,
2502629,
2502631,
2502633,
2502634,
2507770,
2510561,
2512277,
2522355,
2557485,
2557486,
2559117,
2604866,
2605629,
2605634,
2605687,
2612914,
2656995,
2657396,
2841937,
2841938,
2843481,
2843483,
2857754,
2859654,
2859655,
2860423,
2860424,
2899365,
2899741,
2992011,
2998943,
2998944,
2998945,
2998946,
2998947,
3000329,
3000332,
3001630,
3001675,
3001911,
3001913,
3001915,
3001952,
3002081,
3002151,
3002152,
3002157,
3002158,
3002203,
3002204,
3002218,
3002220,
3002225,
3002407,
3002411,
3002412,
3002431,
3002433,
3002434,
3002435,
3002436,
3003931,
3004179,
3004448,
3004621,
3006580,
3067591,
3085789,
3117399,
3132066,
3133949,
3144459,
3144460,
3144467,
3144468,
3144471,
3144472,
3144473,
3144480,
3144487,
3144522,
3144523,
3144524,
3144525,
3144526,
3161742,
3171159,
3171165,
3171172,
3171175,
3194942,
3219332,
3253930,
3256118,
3256119,
3256120,
3256122,
3286092,
3286174,
3303044,
3303048,
3303050,
3304235,
3330995,
3331139,
3331142,
3375694,
3375697,
3410714,
3410715,
3410716,
3420024,
3438928,
3438929,
3438932,
3438939,
3438940,
3438941,
3438942,
3438943,
3438944,
3438945,
3438947,
3438948,
3438949,
3438950,
3438958,
3438959,
3438960,
3438961,
3438963,
3438968,
3438980,
3438982,
3438983,
3438984,
3438986,
3438991,
3438993,
3438995,
3439002,
3528665,
3583096,
3583342,
3596405,
3656101,
3656417,
3692229,
3810523,
3810605,
3883814,
3928271,
3948557,
3948569,
3969103,
3978098,
3978106,
3978107,
3978108,
3978111,
4007352,
4008795,
4024228,
4029626,
4029628,
4029987,
4041916,
4041917,
4041918,
4044916,
4044917,
4044918,
4047951,
4054635,
4054637,
4054638,
4073631,
4081154,
4081155,
4091148,
4091152,
4092141,
4101966,
4101985,
4112750,
4133676,
4134298,
4135798,
4176271,
4176272,
4176273,
4194324,
4194349,
4199392,
4296614,
4361950,
4361951,
4364941,
4364943,
4426160,
4476897,
4487361,
4487363,
4508405,
4508416,
4516193,
4761250,
4761251,
4769855,
4811220,
4856038,
4896156,
4896157,
4908174,
4914563,
4914564,
4914565,
4917624,
4917625,
4917626,
4927215,
4927217,
4927221,
4930283,
4930286,
4930287,
4930288,
4930555,
4930556,
4930557,
4944436,
4944437,
4944439,
4947773,
4976109,
4978928,
4978929,
4981626,
5019474,
5019475,
5019476,
5019477,
5022738,
5022739,
5022740,
5022741,
5022742,
5022743,
5030199,
5030200,
5040877,
5069376,
5069380,
5069382,
5069386,
5069390,
5069392,
5069394,
5069395,
5131017,
5131018,
5131019,
5133696,
5133698,
5142327,
5142726,
5144501,
5144502,
5145119,
5145254,
5145257,
5162259,
5201934,
5214706,
5231570,
5231571,
5239561,
5239562,
5239563,
5256236,
5256241,
5271680,
5271681,
5271682,
5326794,
5326795,
5326796,
5326797,
5326800,
5367440,
5367442,
5367445,
5408062,
5425345,
5425348,
5425350,
5425351,
5490554,
5613772,
5613773,
5613774,
5613775,
5613776,
5613777,
5613778,
5613781,
5613783,
5613784,
5647116,
5671497,
5671501,
5679398,
5679399,
5679400,
5761963
]

calc_space_instruments = acm.Calculations().CreateCalculationSpace(acm.GetDefaultContext(), acm.FDealSheet)
calc_space_trades = acm.Calculations().CreateCalculationSpace(acm.GetDefaultContext(), acm.FTradeSheet)

with open(r'F:\Markets Consulting\invalid_instrument_rename\instrument_post.txt', 'w') as f_instruments:
    with open(r'F:\Markets Consulting\invalid_instrument_rename\trades_post.txt', 'w') as f_trades:
        for insaddr in instruments:
            instrument = acm.FInstrument[insaddr]
            t_price = calc_space_instruments.CreateCalculation(instrument, 'Price Theor')
            trades = instrument.Trades()
            for t in trades:
                cash = calc_space_instruments.CreateCalculation(t, 'Portfolio Cash End')
                val = calc_space_instruments.CreateCalculation(t, 'Portfolio Present Value')
                f_trades.write('%s|%s|%s\n' % (t.Oid(), cash.Value().Number(), val.Value().Number()))
            f_instruments.write('%s|%s|%s\n' % (insaddr, instrument.Name(), t_price.Value().Number()))
